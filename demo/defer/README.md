defer
==============

## defer 是什么

Go 语言中延迟函数 defer 充当着 try...catch 的重任，使用起来也非常简便，然而在实际应用中，很多 gopher 并没有真正搞明白 defer、return、返回值、panic 之间的执行顺序，从而掉进坑中，今天我们就来揭开它的神秘面纱！

多个 defer 的执行顺序为“后进先出/先进后出”；

所有函数在执行 RET 返回指令之前，都会先检查是否存在 defer 语句，若存在则先逆序调用 defer 语句进行收尾工作再退出返回；

匿名返回值是在 return 执行时被声明，有名返回值则是在函数声明的同时被声明，因此在 defer 语句中只能访问有名返回值，而不能直接访问匿名返回值；

return 其实应该包含前后两个步骤：第一步是给返回值赋值（若为有名返回值则直接赋值，若为匿名返回值则先声明再赋值）；第二步是调用 RET 返回指令并传入返回值，而 RET 则会检查 defer 是否存在，若存在就先逆序插播 defer 语句，最后 RET 携带返回值退出函数；
